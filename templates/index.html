<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InJoy</title>
</head>
<style>
    .display{
        display: none;
    }
    .mymouse{
        cursor: pointer;
    }
    #windowBackground{
        width: 100vw;
        background-color: black;
        opacity: 0.25;
        height: 100vh;
        position: fixed;
        z-index: 100;
        margin: 0px 0px 0px 0px ;
    }
    .sign{
        /* display: none; */
        position: fixed;
        z-index: 100;
        background-color: white;
        width: 340px;
        /* height: 275px; */
        height: auto;
        top: 80px;
        left: 50%;
        transform:translate(-50%, 0);
        border-radius: 5px;
    }

    .signHead{
        border-radius: 5px 5px 0px 0px;
        width: 100%;
        height: 10px;
        background: linear-gradient(270deg, #F58652 0%, #ffcab1 100%);
    }


    .signImg{
        background: url(/static/icon_close.png);
        height: 16px;
        width: 16px;
        position: fixed;
        top: 27px;
        right: 17px;
    }
    .signinInput{
        width: 280px;
        height: 17px;
        border: 1px #CCCCCC solid;
        color: #666666;
        padding: 15px;
        font-size: 16px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px 15px;
        text-align: left;
    }

    .signinFoot{
        width: 310px;
        height: 22px;
        font-size: 16px;
        font-weight: 400;
        color: #666666;
        margin: 5px 15px 15px 15px;
        text-align: center;
    }

    /* signup */

    .signTitle{
        margin: 0px auto 0px auto;
        width: 310px;
        height: 27px;
        font-weight: 700;
        font-size: 24px;
        line-height: 24px;
        color: #666666;
        margin: 15px auto 10px auto;
        text-align: center;

    }

    .signupInput{
        width: 280px;
        height: 17px;
        border: 1px #CCCCCC solid;
        color: #666666;
        padding: 15px;
        font-size: 16px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px 15px;
        text-align: left;
    }
    .signButton{
        width: 270px;
        height: 27px;
        background: #F58652;
        border-radius: 5px;
        padding: 10px 20px;
        margin: 5px auto;
    }
    .signButtonText{
        width: 270px;
        height: 27px;
        text-align: center;
        font-size: 19px;
        font-weight: 700;
        color: #ffffff;
    }
    .signupFoot{
        width: 310px;
        height: 22px;
        font-size: 16px;
        font-weight: 700;
        color: #666666;
        margin: 5px 15px 15px 15px;
        text-align: center;
    }

    header{
        background: #ffffff;
        height: 35px;
        width: 100vw;
        position: fixed;
        display: flex;
        padding:5px 0px 5px 0px;
        border-bottom: 1px solid #ffcab1;
    
    }
    .headTitle{
        color: #F58652 ;
        font-weight:700;
        font-size: 30px;
        margin:0px auto 0px auto;
        display: flex;
        justify-content: center;
    }
    .headRight{
        display: flex;
        margin: 8px 10px 0px 0px ;
        font-size:16px;
        position: absolute;
        right: 50px;
    }
    .signInbtn{
        margin-right: 10px;
    }
    .trip{
        margin-right: 10px;
    }

    body{
        margin: 0px;
        font-size: 14px;
        background: linear-gradient(270deg, #F58652 0%, #ffcab1 100%);
    }

    /* index */
    .hero{
        width: 100vw;

        height: 60vh;
        padding-top: 45px;

    }
    .heroTitle{
        width: 100%;
        display: flex;
        justify-content: center;
    }
    .heroContent{
        color: #000000;
        font-weight:700;
        font-size: 48px;
        display: flex;
        justify-content: center;
        width: 100%;
        height: 100%;
        align-items: center;
    }
    .btnPar{
        display: flex;
        width: 100%;
        justify-content: center;
        align-items: center;
    }
    .sign_btn{
        height: 100px;
        line-height:100px;
        background-color: #f6f6f6;
        border: #F58652 solid 1px;
        border-radius: 5px;
        font-size: 24px;
        padding: 0px 10px 0px 10px;
        margin: 0px 5px 0px 5px;

    }
    .scheduleId{
        font-size: 12px;
        width: 20px;
        height: 20px;
        display: none;
    }


</style>
<body onload="checkMember()">
    <header>
            <div class="headTitle mymouse" onclick="location.href='/'">InJoy</div>
            <div class="headRight">
                <div class="trip mymouse" onclick="location.href='/'">個人行程</div>
                <div id="signInbtn" class="signInbtn mymouse" onclick="signinWindow()">會員登入</div>
                <div id="signOutbtn" class="mymouse display" onclick="signOut()">會員登出</div>
            </div>
    </header>
    <div id="windowBackground" class="display" onclick="closeWindow()">
    </div>
    <div  class="sign display" id="signIn">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">登入會員帳號 </div>
        <input class="signinInput" type="email" id="signinEmail" placeholder="輸入電子信箱">
        <input class="signinInput" type="password" id="signinPassword" placeholder="輸入密碼">
        <div class="errorText display" id="signinError" >帳號或密碼輸入錯誤</div>
        <div class="signButton mymouse" onclick="signIn()" >
            <div class="signButtonText" >登入帳戶</div>
        </div>
        <div class="signinFoot mymouse"  onclick="signupWindow()">還沒有帳戶？點此註冊</div>   
    </div>
    
    <div class="sign display" id="signUp">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">註冊會員帳號 </div>
        <input class="signupInput" id="signupName" placeholder="輸入姓名">
        <input class="signupInput" type="email" id="signupEmail" placeholder="輸入電子信箱">
        <input class="signupInput" type="password" id="signupPassword" placeholder="輸入密碼">
        <div class="errorText display" id="signupemailError" >此電子信箱已被註冊</div>
        <div class="errorText display" id="signupspaceError" >欄位為空白或含非法字元</div>
        <div class="signButton mymouse" onclick="signUp()">
            <div class="signButtonText" >註冊新帳戶</div>
        </div>
        <div class="signupFoot mymouse"  onclick="signinWindow()">已經有帳戶？點此登入</div>   
    </div>


    <div>
        <div class="hero">
            <div class="heroContent">Enjoy your days in joy</div>
        </div>
        <div class="btnPar" id="btnPar">
            <div class="sign_btn mymouse" id="signIn_btn" onclick="signinWindow()">登入</div>
            <div class="sign_btn mymouse" id="signUp_btn" onclick="signupWindow()">註冊</div>
            <div class="sign_btn mymouse display" id="newGroup" onclick="addGroup()">建立新板</div>
        </div>
    </div>

    <footer></footer>
</body>
</html>
<script type="text/javascript">
function choseGroup(thisCard){
    let groupId=thisCard.childNodes[1].textContent
    document.location.href="/schedule/"+groupId
}
function addGroup(){
    let addGroupreq=new XMLHttpRequest();
    addGroupreq.open("post","/api/addgroup")
    addGroupreq.onload=function(){
        let groupdata=JSON.parse(this.responseText);
        document.location.href="/schedule/"+groupdata["groupId"]
    }
    addGroupreq.send()
}


// var b = a.childNodes; //获取a的全部子节点；
//       var c = a.parentNode; //获取a的父节点；
//       var d = a.nextSibling; //获取a的下一个兄弟节点
//       var e = a.previousSibling; //获取a的上一个兄弟节点
//       var f = a.firstChild; //获取a的第一个子节点
//       var g = a.lastChild; //获取a的最后一个子节点


//確認使用者登入狀態 
function checkMember(){
        let reqMember=new XMLHttpRequest();
        reqMember.open("get","/api/user")
        reqMember.onload=function(){
            let getdata=JSON.parse(this.responseText);
            console.log(getdata)
            let signInbtn=document.getElementById("signInbtn")
            let signOutbtn=document.getElementById("signOutbtn")
            let newGroup=document.getElementById("newGroup")
            let signIn_btn=document.getElementById("signIn_btn")
            let signUp_btn=document.getElementById("signUp_btn")
            if(getdata["data"]!=null){
                signInbtn.classList.add("display")
                signOutbtn.classList.remove("display")
                signIn_btn.classList.add("display")
                signUp_btn.classList.add("display")
                newGroup.classList.remove("display")
                if(getdata["data"]["groupId"]!=null){
                    let groupLen=getdata["data"]["groupId"].length
                    let n=0
                    while(n<groupLen){
                        let div=document.createElement("div")
                        let btnPar=document.getElementById("btnPar")
                        let iddiv=document.createElement("div")
                        div.setAttribute("onclick","choseGroup(this)")
                        iddiv.classList.add("scheduleId")
                        div.classList.add("sign_btn")
                        div.classList.add("mymouse")
                        div.textContent=getdata["data"]["groupData"][getdata["data"]["groupId"][n]]
                        iddiv.textContent=getdata["data"]["groupId"][n]
                        btnPar.appendChild(div)
                        div.appendChild(iddiv)
                        n+=1
                    }


 
                }
  
            }else{
                signInbtn.classList.remove("display")
                signOutbtn.classList.add("display")
            }
        }
        reqMember.send()
}



//登出
function signOut(){
    let reqsignOut=new XMLHttpRequest()
    reqsignOut.open("delete","/api/user")
    reqsignOut.onload=function(){
        let signInbtn=document.getElementById("signInbtn")
        let signOutbtn=document.getElementById("signOutbtn")
        window.location.reload()
        signInbtn.classList.remove("display")
        signOutbtn.classList.add("display")
        
    }
    reqsignOut.send()
}    
// 登入
function signIn(){
    let signineMail=document.getElementById("signinEmail").value
    let signinPassword=document.getElementById("signinPassword").value
    let signinError=document.getElementById("signinError")
    if(signineMail==""|signinPassword==""){
        signinError.classList.remove("display")
    }else{
        let reqsignIn=new XMLHttpRequest()
        reqsignIn.open("post","/api/user")
        reqsignIn.onload=function(){
            signindata=JSON.parse(this.responseText);
            if (signindata["ok"]==true){
                window.location.reload()
            }else{
                signinError.classList.remove("display")
                console.log(signindata)
            }
            
        }
        reqsignIn.send(JSON.stringify({"email":signineMail,"password":signinPassword}))
    }
}  
//註冊
function signUp(){
    let signupName=document.getElementById("signupName").value
    let signupMail=document.getElementById("signupEmail").value
    let signupPassword=document.getElementById("signupPassword").value
    let signupemailError=document.getElementById("signupemailError")
    let signupspaceError=document.getElementById("signupspaceError")
    // 判斷input是否空白
    if(signupName==""| signupMail==""| signupPassword==""){
        signupspaceError.classList.remove("display")
    }else{
        // 連接註冊API
        let reqsignUp=new XMLHttpRequest();
        reqsignUp.open("post","/api/user")
        reqsignUp.onload=function(){
            signupdata=JSON.parse(this.responseText);
            if(signupdata["ok"]==true){
                //註冊成功則自動登入
                let reqsignIn=new XMLHttpRequest()
                reqsignIn.open("post","/api/user")
                reqsignIn.onload=function(){
                    signindata=JSON.parse(this.responseText);
                    if (signindata["ok"]==true){
                        window.location.reload()
                    }else{
                        let signinError=document.getElementById("signinError")
                        signinError.classList.remove("display")
                    }
                    
                }
                reqsignIn.send(JSON.stringify({"email":signupMail,"password":signupPassword}))
            }else{
                // 註冊失敗顯示原因
                signupspaceError.classList.add("display")
                signupemailError.classList.remove("display")
            }
        }
        reqsignUp.send(JSON.stringify({"name":signupName,"email":signupMail,"password":signupPassword}))

    }
}


// 登入視窗
function signinWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let windowBackground=document.getElementById("windowBackground")
    let signinError=document.getElementById("signinError")
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    windowBackground.classList.remove("display");
    signUp.classList.add("display");
    signIn.classList.remove("display");
    // 隱藏錯誤訊息
    signinError.classList.add("display");
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}
function signupWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    windowBackground.classList.remove("display");
    signUp.classList.remove("display");
    signIn.classList.add("display");
    // 隱藏錯誤訊息
    signinError.classList.add("display");
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}
function closeWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    windowBackground.classList.add("display");
    signUp.classList.add("display");
    signIn.classList.add("display");
    // 隱藏錯誤訊息
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}
</script>