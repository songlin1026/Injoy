<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- websocket -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    <title>InJoy</title>
</head>

<style>
    .display{
        display: none;
    }
    .mymouse{
        cursor: pointer;
    }
    #windowBackground{
        width: 100vw;
        background-color: black;
        opacity: 0.25;
        height: 100vh;
        position: fixed;
        z-index: 100;
        margin: 0px 0px 0px 0px ;
    }
    .sign{
        /* display: none; */
        position: fixed;
        z-index: 100;
        background-color: white;
        width: 340px;
        /* height: 275px; */
        height: auto;
        top: 80px;
        left: 50%;
        transform:translate(-50%, 0);
        border-radius: 5px;
    }

    .signHead{
        border-radius: 5px 5px 0px 0px;
        width: 100%;
        height: 10px;
        background: linear-gradient(270deg, #F58652 0%, #ffcab1 100%);
    }


    .signImg{
        background: url(/static/icon_close.png);
        height: 16px;
        width: 16px;
        position: fixed;
        top: 27px;
        right: 17px;
    }
    .deleteMemberImg{
        background: url(/static/icon_close.png);
        background-size: 100%;
        height: 10px;
        width: 10px;
        position: absolute;
        top: 5px;
        right: 5px;
    }
    .signinInput{
        width: 280px;
        height: 17px;
        border: 1px #CCCCCC solid;
        color: #666666;
        padding: 15px;
        font-size: 16px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px 15px;
        text-align: left;
    }

    .signinFoot{
        width: 310px;
        height: 22px;
        font-size: 16px;
        font-weight: 400;
        color: #666666;
        margin: 5px 15px 15px 15px;
        text-align: center;
    }

    /* signup */

    .signTitle{
        margin: 0px auto 0px auto;
        width: 310px;
        height: 27px;
        font-weight: 700;
        font-size: 24px;
        line-height: 24px;
        color: #666666;
        margin: 15px auto 10px auto;
        text-align: center;

    }

    .signupInput{
        width: 280px;
        height: 17px;
        border: 1px #CCCCCC solid;
        color: #666666;
        padding: 15px;
        font-size: 16px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px 15px;
        text-align: left;
    }
    .signButton{
        width: 270px;
        height: 27px;
        background: #F58652;
        border-radius: 5px;
        padding: 10px 20px;
        margin: 5px auto;
    }
    .signButtonText{
        width: 270px;
        height: 27px;
        text-align: center;
        font-size: 19px;
        font-weight: 700;
        color: #ffffff;
    }




    .signupFoot{
        width: 310px;
        height: 22px;
        font-size: 16px;
        font-weight: 700;
        color: #666666;
        margin: 5px 15px 15px 15px;
        text-align: center;
    }

    header{
        background: #ffffff;
        height: 35px;
        width: 100vw;
        position: fixed;
        display: flex;
        /* justify-content: space-between;
        align-items: center; */
        padding:5px 0px 5px 0px;
        border-bottom: 1px solid #ffcab1;
        z-index:9
    
    }
    .headTitle{
        color: #F58652 ;
        font-weight:700;
        font-size: 30px;
        margin:0px auto 0px auto;
        display: flex;
        justify-content: center;
    }
    .headRight{
        display: flex;
        margin: 8px 10px 0px 0px ;
        font-size:16px;
        position: absolute;
        /* top: 10px; */
        right: 50px;
    }
    .signInbtn{
        margin-right: 10px;
    }
    .trip{
        margin-right: 10px;
    }
    body{
        margin: 0px;
        font-size: 14px;
    }

    .groupMember{
        position: relative;
        width: 280px;
        border: 1px #CCCCCC solid;
        color: #666666;
        padding: 15px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px 15px 10px 15px;
        text-align: left;
    }

    .memberName{
        margin-bottom: 5px;
        font-size: 18px;
    }
    .memberEmail{
        font-size: 16px;
    }




    /* schedule */
    .topBar{
        padding: 65px 0px 0px 10px;
        height: 35px;
        display: flex;
        align-items: center;
        position: relative;
        margin-bottom: 20px;
    }
    .center{
        display: flex;
    }
    .tableName{
        font-size: 18px;
        margin-right: 10px;
        background: #ECEAE9;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
        border: 0px;
    }
    .tableDate{
        margin-right: 10px;
        background: #ECEAE9;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
    }
    .tableMember{
        background: #ECEAE9;
        margin-right: 10px;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
    }
    .inviteBtn{
        background: #ECEAE9;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
        margin-right: 10px;

    }
    .saveBtn{
        background: #ECEAE9;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
    }
    .deleteGroupBtn{
        position: absolute;
        right: 0px;
        background: #ECEAE9;
        border-radius: 5px;
        padding: 2px 5px 2px 5px;
        height: 32px;
        display: flex;
        align-items: center;
    }

    .schedule{
        display: flex;
        align-items: center;
        border:1px solid black;
        border-radius: 5px;
        width: 400px;
        height: 50px;

    }
    .scheduleTime{
        width: 100px;
        margin-left: 10px;
    }
    .scheduleContent{
        width: 100%;
        height: 93%;
        display: flex;
        justify-content: center;
        text-align: center;
        border: 0px;
    }
    .centerLeft{
        display: flex;
        flex-wrap: wrap;
    }
    .card{
        margin-left: 10px;
    }
    .cardTop{
        position: relative;
        width: 100%;
        height: 100px;
        display: flex;
        flex-direction: column;
        background:#ffd8c6;
        border-radius: 5px;
        justify-content: center;
        margin-bottom: 10px;

    }
    .deleteBtn{
        position: absolute;
        top: 5px;
        right: 5px;
        width: 30px;
        height: 30px;
        background: url(/static/icon_delete.png);
    }

    .scheduleId{
        font-size: 12px;
        width: 20px;
        height: 20px;
        display: none;
    }
    .tripDate{
        font-size: 20px;
        width: 100%;
        top:15px;
        display: flex;
        justify-content: center;
    }
    .tripPlace{
        font-size: 30px;
        width: 100%;
        display: flex;
        justify-content: center;
    }
    .tripWeather{
        font-size: 20px;
        width: 100%;
        display: flex;
        justify-content: center;
        top:30px
    }
    .remindText{
        width: 280px;
        height: 47px;
        color: #666666;
        font-size: 16px;
        font-weight: 400;
        border-radius: 5px;
        margin: 5px auto;
        text-align: center;
        line-height: 47px;

    }
    .chatroom{
        width: 300px;
        border-radius: 5px;
        border: 1px solid black;
        margin-left: auto;
        right: 0px;
        top: 0px;
        height: 90vh;
    }

    .chatroomTop{
        height: 45px;
        line-height: 45px;
        font-size: 20px;
        background-color: #ffd8c6;
        text-align: center;

    }
    .chatroomBody{
        height: 80vh;
        
    }
    .chatroomBottom{
        height: 20px;
        display: flex;
        padding: 10px 0px 0px 5px;
    }
    .chatCloud{
        width: 60%;
        margin: 10px 0px 0px 5px;
        border-radius: 5px;
        border: 1px solid black;
        padding: 5px 0px 5px 5px;
    }
    .chatName{
        height: 12px;
        line-height: 12px;
        width: 100%;
        margin-bottom: 5px;
    }
    .chatContent{
        /* height: 12px;
        line-height: 12px; */
        width: 100%;
    }

    .chatroomText{
        width: 240px;
        height: 20px;
        line-height: 20px;
        border-radius: 5px;
    }
    .chatroomSend{
        width: 40px;
        height: 24px;
        line-height: 24px;
        text-align: center;
        margin-left: 5px;
        margin-right: 5px;
        border: 1px solid black;
        border-radius: 5px;
        background-color: #ffd8c6;

    }
    footer{
    background: #757575;
    height: 104px;
    display: flex;
    align-items: center;
    width: 100%;
    margin-top: 40px;
    }
    .foot{
        line-height: 13px;
        margin: auto;
        font-style: normal;
        font-weight: bold;
        font-size: 16px;
        line-height: 13px;
        color: #FFFFFF;
    } 




    /* <div class="chatroom">
            <div class="chatroomTop" >聊天室</div>
            <div class="chatroomBody">
                <div class="chatCloud">
                    <div>member</div>
                    <div>你過的好嗎</div>
                </div>
            </div>
                  <div class="chatCloud">
                    <div class="chatName">member</div>
                    <div class="chatContent">你過的好嗎</div>
                </div>
        </div> */


</style>
<body onload="checkMember()">
    <header>
            <div class="headTitle mymouse" onclick="location.href='/'">InJoy</div>
            <div class="headRight">
                <div class="trip mymouse" onclick="location.href='/'">個人行程</div>
                <div id="signInbtn" class="signInbtn mymouse" onclick="signinWindow()">會員登入</div>
                <div id="signOutbtn" class="mymouse display" onclick="signOut()">會員登出</div>
            </div>
    </header>
    <div id="windowBackground" class="display" onclick="closeWindow()">
    </div>
    <div  class="sign display" id="signIn">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">登入會員帳號 </div>
        <input class="signinInput" type="email" id="signinEmail" placeholder="輸入電子信箱">
        <input class="signinInput" type="password" id="signinPassword" placeholder="輸入密碼">
        <div class="errorText display" id="signinError" >帳號或密碼輸入錯誤</div>
        <div class="signButton mymouse" onclick="signIn()" >
            <div class="signButtonText" >登入帳戶</div>
        </div>
        <div class="signinFoot mymouse"  onclick="signupWindow()">還沒有帳戶？點此註冊</div>   
    </div>
    
    <div class="sign display" id="signUp">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">註冊會員帳號 </div>
        <input class="signupInput" id="signupName" placeholder="輸入姓名">
        <input class="signupInput" type="email" id="signupEmail" placeholder="輸入電子信箱">
        <input class="signupInput" type="password" id="signupPassword" placeholder="輸入密碼">
        <div class="errorText display" id="signupemailError" >此電子信箱已被註冊</div>
        <div class="errorText display" id="signupspaceError" >欄位為空白或含非法字元</div>
        <div class="signButton mymouse" onclick="signUp()">
            <div class="signButtonText" >註冊新帳戶</div>
        </div>
        <div class="signupFoot mymouse"  onclick="signinWindow()">已經有帳戶？點此登入</div>   
    </div>

    <div class="sign display" id="addCard">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">輸入旅程地點及日期</div>
        <input class="signupInput" id="cardPlace" placeholder="輸入地點(縣市)">
        <input class="signupInput" type="date" id="cardDate" placeholder="輸入日期">
        <div class="errorText display" id="signupemailError" >此電子信箱已被註冊</div>
        <div class="errorText display" id="signupspaceError" >欄位為空白或含非法字元</div>
        <div class="signButton mymouse" onclick="addCard()">
            <div class="signButtonText " >新增行程</div>
        </div> 
    </div>

    <div class="sign display" id="inviteMember">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">邀請成員</div>
        <input class="signupInput"  type="email" id="inviteEmail" placeholder="輸入電子信箱">
        <div class="errorText display"  >欄位為空白或含非法字元</div>
        <div class="signButton mymouse" onclick="addMember()">
            <div class="signButtonText " >邀請成員</div>
        </div> 
    </div>

    <div class="sign display" id="Member">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">群組成員</div>
        <!-- <div class="groupMember" id="groupMember">
            <div class="signImg mymouse"  onclick="deleteMemberWindow(this)"></div>
            <div class="memberName">名字</div>
            <div class="memberEmail">test@test.com</div>
        </div> -->
    </div>
    <div class="sign display" id="deleteMember">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">確認刪除此成員觀看權限</div>
        <div class="remindText" id="deleteMembermail"></div>
        <div class="signButton mymouse" onclick="deleteMember()">
            <div class="signButtonText " >是</div>
        </div> 
        <div class="signButton mymouse" onclick="closeWindow()">
            <div class="signButtonText " >否</div>
        </div> 
    </div>

    <div class="sign display" id="deleteCard">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">確認是否刪除此欄位</div>
        <div class="remindText">刪除後將無法復原</div>
        <div class="signButton mymouse" onclick="deleteSchedule()">
            <div class="signButtonText " >是</div>
        </div> 
        <div class="signButton mymouse" onclick="closeWindow()">
            <div class="signButtonText " >否</div>
        </div> 
    </div>

    <div class="sign display" id="deleteGroup">
        <div class="signHead"></div>
        <div class="signImg mymouse"  onclick="closeWindow()"></div>
        <div class="signTitle">確認是否刪除此看板</div>
        <div class="remindText">刪除後行程資料將無法復原</div>
        <div class="signButton mymouse" onclick="deleteGroup()">
            <div class="signButtonText " >是</div>
        </div> 
        <div class="signButton mymouse" onclick="closeWindow()">
            <div class="signButtonText " >否</div>
        </div> 
    </div>



    <div class="topBar">
        <input class="tableName" id="groupName" type="text">
        <div class="tableDate mymouse" onclick="addCardWindow()">新增行程</div>
        <div class="tableMember mymouse" onclick="memberWindow()">群組成員</div>
        <div class="inviteBtn mymouse"  onclick="invite()">邀請成員</div>
        <div class="saveBtn mymouse" onclick="saveSchedule()">儲存行程</div>
        <div class="deleteGroupBtn mymouse" onclick="deleteGroupWindow()">刪除看板</div>
    </div>
    <div class="center">
        <div class="centerLeft" id="centerLeft">
            <!-- <div class="card">
                <div class="cardTop">
                    <div class="tripPlace">台南</div>
                    <div class="tripDate">2021-06-24</div>
                    <div class="tripWeather">晴朗炎熱</div>
                </div>
                <div class="cardBody" id="dayOne">
                    <div class="schedule">
                        <div class="scheduleTime">00:00-01:00</div>
                        <div class="scheduleContent">睡覺</div>
                    </div>
                </div>
            </div> -->
        </div>
        <div class="chatroom">
            <div class="chatroomTop" >聊天室</div>
            <div class="chatroomBody" id="chatroomBody">
                <!-- <div class="chatCloud">
                    <div class="chatName">member</div>
                    <div class="chatContent">你過的好嗎</div>
                </div> -->
            </div>
            <div class="chatroomBottom">
                <input class="chatroomText" id="chatroomText" type="text">
                <div class="chatroomSend mymouse" onclick="sendmessage()">送出</div>
            </div>
        </div>

    </div>

    <footer>
        <div class="foot">
            COPYRIGHT © 2021 InJoy   
        </div>
    </footer>
</body>
</html>
<script type="text/javascript">
function deleteGroup(){
    let groupId=location.pathname.split("/")[2]
    let deleteGroupreq=new XMLHttpRequest();
    deleteGroupreq.open("delete","/api/addgroup");
    deleteGroupreq.onload=function(){
        Result=JSON.parse(this.responseText);
        alert(Result["message"])
        window.location.href='/'
    }
    deleteGroupreq.send(JSON.stringify({"groupId":groupId}))
}

function deleteGroupWindow(){
    let deleteGroup=document.getElementById("deleteGroup")
    let windowBackground=document.getElementById("windowBackground")
    deleteGroup.classList.remove("display")
    windowBackground.classList.remove("display")
}


function deleteMember(){
    let groupId=location.pathname.split("/")[2]
    let deleteMemberreq=new XMLHttpRequest();
    deleteMemberreq.open("delete","/api/inviteMember");
    deleteMemberreq.onload=function(){
        Result=JSON.parse(this.responseText);
        alert(Result["message"])
        window.location.reload()
    }
    deleteMemberreq.send(JSON.stringify({"mail":deletethisMember,"groupId":groupId}))
}
function deleteMemberWindow(thisMember){
    deletethisMember=thisMember.parentNode.childNodes[2].textContent
    let deleteMember=document.getElementById("deleteMember")
    let windowBackground=document.getElementById("windowBackground")
    let Member=document.getElementById("Member")
    let deleteMembermail=document.getElementById("deleteMembermail")
    deleteMembermail.textContent=deletethisMember
    Member.classList.add("display")
    deleteMember.classList.remove("display")
    windowBackground.classList.remove("display")
}

function deleteSchedule(){
    let scheduleId=deleteObj.childNodes[0].childNodes[0].textContent
    let groupId=location.pathname.split("/")[2]
    let deletecardreq=new XMLHttpRequest();
    deletecardreq.open("delete","/api/addcard");
    deletecardreq.onload=function(){
        alert("行程已刪除")
        window.location.reload()
    }
    deletecardreq.send(JSON.stringify({"scheduleId":scheduleId,"groupId":groupId}))
}

function deleteScheduleWindow(myObj){
    deleteObj=myObj.parentNode.parentNode
    let deleteCard=document.getElementById("deleteCard")
    let windowBackground=document.getElementById("windowBackground")
    windowBackground.classList.remove("display")
    deleteCard.classList.remove("display")
    // myObj.parentNode.parentNode.innerHTML=""
}

function addMember(){
    let inviteEmail=document.getElementById("inviteEmail").value
    let groupId=location.pathname.split("/")[2]
    if (inviteEmail.indexOf("@")>=0){
        let invitedatareq=new XMLHttpRequest();
        invitedatareq.open("post","/api/inviteMember");
        invitedatareq.onload=function(){
            Result=JSON.parse(this.responseText);
            alert(Result["message"])
            window.location.reload()
        }
        invitedatareq.send(JSON.stringify({"mail":inviteEmail,"groupId":groupId}))
    }else{
        alert("請輸入電子信箱")
    }
}


function memberWindow(){
    let Member=document.getElementById("Member")
    let windowBackground=document.getElementById("windowBackground")
    Member.classList.remove("display")
    windowBackground.classList.remove("display")
}

function invite(){
    let inviteMember=document.getElementById("inviteMember")
    let windowBackground=document.getElementById("windowBackground")
    inviteMember.classList.remove("display")
    windowBackground.classList.remove("display")
}

function saveSchedule(){
    let groupName=document.getElementById("groupName").value
    let groupId=location.pathname.split("/")[2]
    let scheduleId=[]
    let sendData={
        "email": "test@test.test",
        "groupName": groupName,
        "groupId": groupId
    }
    let m=0
    let scheduleLen=document.getElementsByClassName("scheduleId").length
    while(m<scheduleLen){
        if(document.getElementById("place_"+m)==null){
            m+=1
            scheduleLen+=1
        }else{
            let schedule_Id=document.getElementById("id_"+m).textContent
            let place=document.getElementById("place_"+m).textContent
            let date=document.getElementById("date_"+m).textContent
            scheduleId.push(schedule_Id)
            let scheduleDir={}
            scheduleDir["place"]=place
            scheduleDir["date"]=date
            let n=0
            while(n<=23){
                let content=document.getElementById("Content_"+m+"_"+n).value
                if(content!=""){
                    scheduleDir[n]=content
                    n+=1
                }else{
                    n+=1
                }
            }
            sendData[schedule_Id]=scheduleDir
            m+=1
        }
    }
    sendData["scheduleId"]=scheduleId
    let savedatareq=new XMLHttpRequest();
    savedatareq.open("post","/api"+location.pathname);
    savedatareq.onload=function(){
        saveResult=JSON.parse(this.responseText);
        alert(saveResult["message"])
    }
    savedatareq.send(JSON.stringify({"data":sendData}))
}


let getdatareq=new XMLHttpRequest();
getdatareq.open("get","/api/"+location.pathname);
getdatareq.onload=function(){
    groupData=JSON.parse(this.responseText);
    console.log(groupData)
    if(groupData["data"]=="無權限觀看此看板"){
        alert("無權限觀看此看板")
        window.location.href='/'
    }else{
        chatroomDataLen=groupData["data"]["chatroomData"].length
        let x=0
        while(x<chatroomDataLen){
            // create div
            let chatroomBody=document.getElementById("chatroomBody")
            let CloudDiv=document.createElement("div")
            let NameDiv=document.createElement("div")
            let ContentDiv=document.createElement("div")
            // add class
            CloudDiv.classList.add("chatCloud")
            NameDiv.classList.add("chatName")
            ContentDiv.classList.add("chatContent")
            // add textcontent
            NameDiv.textContent=groupData["data"]["chatroomData"][x][0]
            ContentDiv.textContent=groupData["data"]["chatroomData"][x][1]
            // append html
            chatroomBody.appendChild(CloudDiv)
            CloudDiv.appendChild(NameDiv)
            CloudDiv.appendChild(ContentDiv)
            x+=1
        }
        // member html
        let Member=document.getElementById("Member")
        let memberLen=0
        while(memberLen<groupData["data"]["email"].length){
            let memberDiv=document.createElement("div")
            let nameDiv=document.createElement("div")
            let mailDiv=document.createElement("div")
            let deleteDiv=document.createElement("div")
            memberDiv.classList.add("groupMember")
            nameDiv.classList.add("memberName")
            mailDiv.classList.add("memberEmail")
            deleteDiv.classList.add("deleteMemberImg")
            deleteDiv.classList.add("mymouse")
            deleteDiv.setAttribute("onclick","deleteMemberWindow(this)")
            nameDiv.textContent=groupData["data"]["member"][groupData["data"]["email"][memberLen]]
            mailDiv.textContent=groupData["data"]["email"][memberLen]
            Member.appendChild(memberDiv)
            memberDiv.appendChild(deleteDiv)
            memberDiv.appendChild(nameDiv)
            memberDiv.appendChild(mailDiv)
            memberLen+=1
        }

        // 行程html
        let groupName=document.getElementById("groupName")
        let centerLeft=document.getElementById("centerLeft")
        let m=0
        while(m<groupData["data"]["scheduleId"].length){
            let scheduleId=groupData["data"]["scheduleId"][m]
            groupName.value=groupData["data"]["groupName"]
            let cardPlace=groupData["data"][scheduleId]["place"]
            let cardDate=groupData["data"][scheduleId]["date"]
            // create div 
            let div=document.createElement("div")
            let Topdiv=document.createElement("div")
            let Placediv=document.createElement("div")
            let Datediv=document.createElement("div")
            let Weatherdiv=document.createElement("div")
            let Bodydiv=document.createElement("div")
            let iddiv=document.createElement("div")
            let deleteBtn=document.createElement("div")
            // 設定id
            div.setAttribute("id","card_"+m)
            Placediv.setAttribute("id","place_"+m)
            Datediv.setAttribute("id","date_"+m)
            iddiv.setAttribute("id","id_"+m)
            deleteBtn.setAttribute("id","delete_"+m)
            deleteBtn.setAttribute("onclick","deleteScheduleWindow(this)")
            // dom 文字更改
            Placediv.textContent=cardPlace
            Datediv.textContent=cardDate
            iddiv.textContent=scheduleId

            // add class
            div.classList.add("card")
            Topdiv.classList.add("cardTop")
            Placediv.classList.add("tripPlace")
            Datediv.classList.add("tripDate")
            Bodydiv.classList.add("cardBody")
            iddiv.classList.add("scheduleId")
            deleteBtn.classList.add("deleteBtn")
            deleteBtn.classList.add("mymouse")
            // html
            centerLeft.appendChild(div)
            div.appendChild(Topdiv)
            div.appendChild(Bodydiv)
            Topdiv.appendChild(iddiv)
            Topdiv.appendChild(Placediv)
            Topdiv.appendChild(Datediv)
            if(groupData["data"][scheduleId]["weather"]!=null){
                Weatherdiv.textContent=groupData["data"][scheduleId]["weather"]
                Weatherdiv.classList.add("tripWeather")
                Topdiv.appendChild(Weatherdiv)
            }
            Topdiv.appendChild(deleteBtn)

            // 行程
            let n=0
            while(n<=23){
                let schedulediv=document.createElement("div")
                let Timediv=document.createElement("div")
                let Contentdiv=document.createElement("input")
                schedulediv.classList.add("schedule")
                Timediv.classList.add("scheduleTime")
                Contentdiv.classList.add("scheduleContent")
                Contentdiv.setAttribute("type","text")
                if(groupData["data"][scheduleId][n]!=null){
                    if(n<=8){
                        Timediv.textContent="0"+n+":00-0"+(n+1)+":00"
                        Contentdiv.value=groupData["data"][scheduleId][n]
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else if(n==9){
                        Timediv.textContent="0"+n+":00-"+(n+1)+":00"
                        Contentdiv.value=groupData["data"][scheduleId][n]
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else if(n==23){
                        Timediv.textContent=n+":00-00:00"
                        Contentdiv.value=groupData["data"][scheduleId][n]
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else{
                        Timediv.textContent=n+":00-"+(n+1)+":00"
                        Contentdiv.value=groupData["data"][scheduleId][n]
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }
                }else{
                    if(n<=8){
                        Timediv.textContent="0"+n+":00-0"+(n+1)+":00"
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else if(n==9){
                        Timediv.textContent="0"+n+":00-"+(n+1)+":00"
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else if(n==23){
                        Timediv.textContent=n+":00-00:00"
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }else{
                        Timediv.textContent=n+":00-"+(n+1)+":00"
                        Contentdiv.setAttribute("id","Content_"+m+"_"+n)
                        Bodydiv.appendChild(schedulediv)
                        schedulediv.appendChild(Timediv)
                        schedulediv.appendChild(Contentdiv)
                        n+=1
                    }
                }
            }
            m+=1
        }
    }

    
}
getdatareq.send()


function schedule(){
    let n=0
    while(n<=23){
        let dayOne=document.getElementById("dayOne")
        let schedulediv=document.createElement("div")
        let Timediv=document.createElement("div")
        let Contentdiv=document.createElement("input")
        schedulediv.classList.add("schedule")
        Timediv.classList.add("scheduleTime")
        Contentdiv.classList.add("scheduleContent")
        Contentdiv.setAttribute("type","text")
        if(n<=8){
            Timediv.textContent="0"+n+":00-0"+(n+1)+":00"
            Contentdiv.textContent="456"
            dayOne.appendChild(schedulediv)
            schedulediv.appendChild(Timediv)
            schedulediv.appendChild(Contentdiv)
            n+=1
        }else if(n==9){
            Timediv.textContent="0"+n+":00-"+(n+1)+":00"
            Contentdiv.textContent="456"
            dayOne.appendChild(schedulediv)
            schedulediv.appendChild(Timediv)
            schedulediv.appendChild(Contentdiv)
            n+=1
        }else if(n==23){
            Timediv.textContent=n+":00-00:00"
            Contentdiv.textContent="456"
            dayOne.appendChild(schedulediv)
            schedulediv.appendChild(Timediv)
            schedulediv.appendChild(Contentdiv)
            n+=1
        }else{
            Timediv.textContent=n+":00-"+(n+1)+":00"
            Contentdiv.textContent="456"
            dayOne.appendChild(schedulediv)
            schedulediv.appendChild(Timediv)
            schedulediv.appendChild(Contentdiv)
            n+=1
        }
    }
}
// schedule()

function addCard(){
    let centerLeft=document.getElementById("centerLeft")
    let cardPlace=document.getElementById("cardPlace").value
    let cardDate=document.getElementById("cardDate").value
    let groupId=location.pathname.split("/")[2]

    let addcardreq=new XMLHttpRequest();
    addcardreq.open("post","/api/addcard");
    addcardreq.onload=function(){
        window.location.reload()
        // let addcarddata=JSON.parse(this.responseText);
        // console.log(addcarddata)
        // let div=document.createElement("div")
        // let Topdiv=document.createElement("div")
        // let Placediv=document.createElement("div")
        // let Datediv=document.createElement("div")
        // let Weatherdiv=document.createElement("div")
        // let Bodydiv=document.createElement("div")
        // let deleteBtn=document.createElement("div")
        // let iddiv=document.createElement("div")
        // Placediv.textContent=cardPlace
        // Datediv.textContent=cardDate
        // Weatherdiv.textContent="晴朗炎熱"
        // iddiv.textContent=addcarddata["data"]["scheduleId"]
        // let len=document.getElementsByClassName("tripPlace").length
        // console.log(len)
        // // id set
        // iddiv.setAttribute("id","id_"+len)
        // deleteBtn.setAttribute("id","delete_"+len)
        // deleteBtn.setAttribute("onclick","deleteSchedule(this)")
        // // class set
        // div.classList.add("card")
        // Topdiv.classList.add("cardTop")
        // Placediv.classList.add("tripPlace")
        // Datediv.classList.add("tripDate")
        // Weatherdiv.classList.add("tripWeather")
        // Bodydiv.classList.add("cardBody")
        // iddiv.classList.add("scheduleId")
        // deleteBtn.classList.add("deleteBtn")
        // deleteBtn.classList.add("mymouse")
        // // 放入html
        // centerLeft.appendChild(div)
        // div.appendChild(Topdiv)
        // div.appendChild(Bodydiv)
        // Topdiv.appendChild(Placediv)
        // Topdiv.appendChild(Datediv)
        // Topdiv.appendChild(Weatherdiv)
        // Topdiv.appendChild(iddiv)
        // Topdiv.appendChild(deleteBtn)
        // let n=0
        // while(n<=23){
        //     let schedulediv=document.createElement("div")
        //     let Timediv=document.createElement("div")
        //     let Contentdiv=document.createElement("input")
        //     schedulediv.classList.add("schedule")
        //     Timediv.classList.add("scheduleTime")
        //     Contentdiv.classList.add("scheduleContent")
        //     Contentdiv.setAttribute("id","Content_"+len+"_"+n)
        //     Contentdiv.setAttribute("type","text")
        //     if(n<=8){
        //         Timediv.textContent="0"+n+":00-0"+(n+1)+":00"
        //         Bodydiv.appendChild(schedulediv)
        //         schedulediv.appendChild(Timediv)
        //         schedulediv.appendChild(Contentdiv)
        //         n+=1
        //     }else if(n==9){
        //         Timediv.textContent="0"+n+":00-"+(n+1)+":00"
        //         Bodydiv.appendChild(schedulediv)
        //         schedulediv.appendChild(Timediv)
        //         schedulediv.appendChild(Contentdiv)
        //         n+=1
        //     }else if(n==23){
        //         Timediv.textContent=n+":00-00:00"
        //         Bodydiv.appendChild(schedulediv)
        //         schedulediv.appendChild(Timediv)
        //         schedulediv.appendChild(Contentdiv)
        //         n+=1
        //     }else{
        //         Timediv.textContent=n+":00-"+(n+1)+":00"
        //         Bodydiv.appendChild(schedulediv)
        //         schedulediv.appendChild(Timediv)
        //         schedulediv.appendChild(Contentdiv)
        //         n+=1
        //     }
        // }
        // let addCard=document.getElementById("addCard")
        // let windowBackground=document.getElementById("windowBackground")
        // addCard.classList.add("display");
        // windowBackground.classList.add("display");
    }
    addcardreq.send(JSON.stringify({"place":cardPlace,"date":cardDate,"groupId":groupId}))


 
}

function addCardWindow(){
    let addCard=document.getElementById("addCard")
    let windowBackground=document.getElementById("windowBackground")
    addCard.classList.remove("display");
    windowBackground.classList.remove("display");
}

//確認使用者登入狀態 
function checkMember(){
        let reqMember=new XMLHttpRequest();
        reqMember.open("get","/api/user")
        reqMember.onload=function(){
            let getdata=JSON.parse(this.responseText);
            let signInbtn=document.getElementById("signInbtn")
            let signOutbtn=document.getElementById("signOutbtn")
            if(getdata["data"]!=null){
                signInbtn.classList.add("display")
                signOutbtn.classList.remove("display")
                // headsignin.style.display="none"

            }else{
                signInbtn.classList.remove("display")
                signOutbtn.classList.add("display")
                // headsignout.style.display="none"

            }
        }
        reqMember.send()
}

//登出
function signOut(){
    let reqsignOut=new XMLHttpRequest()
    reqsignOut.open("delete","/api/user")
    reqsignOut.onload=function(){
        let signInbtn=document.getElementById("signInbtn")
        let signOutbtn=document.getElementById("signOutbtn")
        window.location.reload()
        signInbtn.classList.remove("display")
        signOutbtn.classList.add("display")
        
    }
    reqsignOut.send()
}    
// 登入
function signIn(){
    let signineMail=document.getElementById("signinEmail").value
    let signinPassword=document.getElementById("signinPassword").value
    let signinError=document.getElementById("signinError")
    if(signineMail==""|signinPassword==""){
        signinError.classList.remove("display")
    }else{
        let reqsignIn=new XMLHttpRequest()
        reqsignIn.open("post","/api/user")
        reqsignIn.onload=function(){
            signindata=JSON.parse(this.responseText);
            if (signindata["ok"]==true){
                window.location.reload()
            }else{
                signinError.classList.remove("display")
                console.log(signindata)
            }
            
        }
        reqsignIn.send(JSON.stringify({"email":signineMail,"password":signinPassword}))
    }
}  
//註冊
function signUp(){
    let signupName=document.getElementById("signupName").value
    let signupMail=document.getElementById("signupEmail").value
    let signupPassword=document.getElementById("signupPassword").value
    let signupemailError=document.getElementById("signupemailError")
    let signupspaceError=document.getElementById("signupspaceError")
    // 判斷input是否空白
    if(signupName==""| signupMail==""| signupPassword==""){
        signupspaceError.classList.remove("display")
    }else{
        // 連接註冊API
        let reqsignUp=new XMLHttpRequest();
        reqsignUp.open("post","/api/user")
        reqsignUp.onload=function(){
            signupdata=JSON.parse(this.responseText);
            if(signupdata["ok"]==true){
                //註冊成功則自動登入
                let reqsignIn=new XMLHttpRequest()
                reqsignIn.open("post","/api/user")
                reqsignIn.onload=function(){
                    signindata=JSON.parse(this.responseText);
                    if (signindata["ok"]==true){
                        window.location.reload()
                    }else{
                        let signinError=document.getElementById("signinError")
                        signinError.classList.remove("display")
                    }
                    
                }
                reqsignIn.send(JSON.stringify({"email":signupMail,"password":signupPassword}))
            }else{
                // 註冊失敗顯示原因
                signupspaceError.classList.add("display")
                signupemailError.classList.remove("display")
            }
        }
        reqsignUp.send(JSON.stringify({"name":signupName,"email":signupMail,"password":signupPassword}))

    }
}

// 登入視窗
function signinWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let windowBackground=document.getElementById("windowBackground")
    let signinError=document.getElementById("signinError")
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    windowBackground.classList.remove("display");
    signUp.classList.add("display");
    signIn.classList.remove("display");
    // 隱藏錯誤訊息
    signinError.classList.add("display");
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}
function signupWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    windowBackground.classList.remove("display");
    signUp.classList.remove("display");
    signIn.classList.add("display");
    // 隱藏錯誤訊息
    signinError.classList.add("display");
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}
function closeWindow(){
    let signIn=document.getElementById("signIn");
    let signUp=document.getElementById("signUp");
    let addCard=document.getElementById("addCard")
    let signupspaceError=document.getElementById("signupspaceError")
    let signupemailError=document.getElementById("signupemailError")
    let inviteMember=document.getElementById("inviteMember")
    let Member=document.getElementById("Member")
    let deleteCard=document.getElementById("deleteCard")
    let deleteMember=document.getElementById("deleteMember")
    let deleteGroup=document.getElementById("deleteGroup")
    windowBackground.classList.add("display");
    signUp.classList.add("display");
    signIn.classList.add("display");
    addCard.classList.add("display");
    inviteMember.classList.add("display")
    Member.classList.add("display")
    deleteCard.classList.add("display")
    deleteMember.classList.add("display")
    deleteGroup.classList.add("display")
    // 隱藏錯誤訊息
    signupspaceError.classList.add("display");
    signupemailError.classList.add("display");
}


let socket = io();
function sendmessage(){
    let chatroomText=document.getElementById("chatroomText").value
    let socket = io.connect();
    socket.on('connect',function(){
        let groupId=location.pathname.split("/")[2]
        socket.emit('my send',{"content":chatroomText,"groupId":groupId})
        document.getElementById("chatroomText").value=null
    })
}



socket.on("my change",function(msg){
    console.log(msg)
    // create div
    let chatroomBody=document.getElementById("chatroomBody")
    let CloudDiv=document.createElement("div")
    let NameDiv=document.createElement("div")
    let ContentDiv=document.createElement("div")
    // add class
    CloudDiv.classList.add("chatCloud")
    NameDiv.classList.add("chatName")
    ContentDiv.classList.add("chatContent")
    // add textcontent
    NameDiv.textContent=msg["member"]
    ContentDiv.textContent=msg["content"]
    // append html
    chatroomBody.appendChild(CloudDiv)
    CloudDiv.appendChild(NameDiv)
    CloudDiv.appendChild(ContentDiv)
})

</script>
